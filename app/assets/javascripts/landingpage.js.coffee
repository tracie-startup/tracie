# Place all the behaviors and hooks related to the matching controller here.
# All this logic will automatically be available in application.js.
# You can use CoffeeScript in this file: http://coffeescript.org/
ready = ->
  points_instances = []

  raw_points = [{"type":"Feature","geometry":{"type":"Point","coordinates":[11.6291814,52.1195724]},"properties":{"name":"Netz39","description":"Der Ort an dem Tracie gehackt wird","circle_options":{"color":"#e74c3c","opacity":1,"weight":3,"fillColor":"#e74c3c","fillOpacity":1}}},{"type":"Feature","geometry":{"type":"Point","coordinates":[11.629283130168915,52.11989325575632]},"properties":{"name":"Foobar","description":"","circle_options":{"color":"#e74c3c","opacity":1,"weight":3,"fillColor":"#e74c3c","fillOpacity":1}}},{"type":"Feature","geometry":{"type":"Point","coordinates":[11.629497706890106,52.12015346620027]},"properties":{"name":"Ach so","description":"","circle_options":{"color":"#e74c3c","opacity":1,"weight":3,"fillColor":"#e74c3c","fillOpacity":1}}},{"type":"Feature","geometry":{"type":"Point","coordinates":[11.62976324558258,52.120433437766174]},"properties":{"name":"last one","description":"","circle_options":{"color":"#e74c3c","opacity":1,"weight":3,"fillColor":"#e74c3c","fillOpacity":1}}},{"type":"Feature","geometry":{"type":"Point","coordinates":[11.629824936389923,52.1207265825799]},"properties":{"name":"last","description":"","circle_options":{"color":"#e74c3c","opacity":1,"weight":3,"fillColor":"#e74c3c","fillOpacity":1}}},{"type":"Feature","geometry":{"type":"Point","coordinates":[11.63178563117981,52.12474148434946]},"properties":{"name":"","description":"","circle_options":{"color":"#e74c3c","opacity":1,"weight":3,"fillColor":"#e74c3c","fillOpacity":1}}},{"type":"Feature","geometry":{"type":"Point","coordinates":[11.631495952606201,52.12447800721776]},"properties":{"name":"","description":"","circle_options":{"color":"#e74c3c","opacity":1,"weight":3,"fillColor":"#e74c3c","fillOpacity":1}}},{"type":"Feature","geometry":{"type":"Point","coordinates":[11.631227731704712,52.124109136616376]},"properties":{"name":"","description":"","circle_options":{"color":"#e74c3c","opacity":1,"weight":3,"fillColor":"#e74c3c","fillOpacity":1}}},{"type":"Feature","geometry":{"type":"Point","coordinates":[11.630862951278685,52.12377978528505]},"properties":{"name":"","description":"","circle_options":{"color":"#e74c3c","opacity":1,"weight":3,"fillColor":"#e74c3c","fillOpacity":1}}},{"type":"Feature","geometry":{"type":"Point","coordinates":[11.630589365959167,52.12352288955692]},"properties":{"name":"","description":"","circle_options":{"color":"#e74c3c","opacity":1,"weight":3,"fillColor":"#e74c3c","fillOpacity":1}}},{"type":"Feature","geometry":{"type":"Point","coordinates":[11.630310416221619,52.12316718533478]},"properties":{"name":"","description":"","circle_options":{"color":"#e74c3c","opacity":1,"weight":3,"fillColor":"#e74c3c","fillOpacity":1}}},{"type":"Feature","geometry":{"type":"Point","coordinates":[11.630310416221619,52.122811478273604]},"properties":{"name":"","description":"","circle_options":{"color":"#e74c3c","opacity":1,"weight":3,"fillColor":"#e74c3c","fillOpacity":1}}},{"type":"Feature","geometry":{"type":"Point","coordinates":[11.629859805107117,52.122903698895406]},"properties":{"name":"","description":"","circle_options":{"color":"#e74c3c","opacity":1,"weight":3,"fillColor":"#e74c3c","fillOpacity":1}}},{"type":"Feature","geometry":{"type":"Point","coordinates":[11.628829836845398,52.12324623096285]},"properties":{"name":"","description":"","circle_options":{"color":"#e74c3c","opacity":1,"weight":3,"fillColor":"#e74c3c","fillOpacity":1}}},{"type":"Feature","geometry":{"type":"Point","coordinates":[11.628218293190002,52.123410908904326]},"properties":{"name":"","description":"","circle_options":{"color":"#e74c3c","opacity":1,"weight":3,"fillColor":"#e74c3c","fillOpacity":1}}},{"type":"Feature","geometry":{"type":"Point","coordinates":[11.62801444530487,52.12316059819281]},"properties":{"name":"","description":"","circle_options":{"color":"#e74c3c","opacity":1,"weight":3,"fillColor":"#e74c3c","fillOpacity":1}}},{"type":"Feature","geometry":{"type":"Point","coordinates":[11.631597876548767,52.11932671637091]},"properties":{"name":"","description":"","circle_options":{"color":"#e74c3c","opacity":1,"weight":3,"fillColor":"#e74c3c","fillOpacity":1}}},{"type":"Feature","geometry":{"type":"Point","coordinates":[11.627763658761978,52.1209324415495]},"properties":{"name":"","description":"","circle_options":{"color":"#e74c3c","opacity":1,"weight":3,"fillColor":"#e74c3c","fillOpacity":1}}},{"type":"Feature","geometry":{"type":"Point","coordinates":[11.627917885780334,52.12092091347234]},"properties":{"name":"","description":"","circle_options":{"color":"#e74c3c","opacity":1,"weight":3,"fillColor":"#e74c3c","fillOpacity":1}}},{"type":"Feature","geometry":{"type":"Point","coordinates":[11.627853512763977,52.12082210126002]},"properties":{"name":"","description":"","circle_options":{"color":"#e74c3c","opacity":1,"weight":3,"fillColor":"#e74c3c","fillOpacity":1}}},{"type":"Feature","geometry":{"type":"Point","coordinates":[11.627907156944273,52.1209670257631]},"properties":{"name":"","description":"","circle_options":{"color":"#e74c3c","opacity":1,"weight":3,"fillColor":"#e74c3c","fillOpacity":1}}},{"type":"Feature","geometry":{"type":"Point","coordinates":[11.631968021392822,52.12143473344495]},"properties":{"name":"","description":"","circle_options":{"color":"#e74c3c","opacity":1,"weight":3,"fillColor":"#e74c3c","fillOpacity":1}}}]

  insertNextPoint = ->
    console.dir raw_points
    if raw_points.length
      point = raw_points.pop()
      points_instances.push L.circle([point.geometry.coordinates[1], point.geometry.coordinates[0]], 10,point.properties.circle_options).addTo(test_map)

    for point in points_instances
      if point.options.opacity > 0.02
        point.setStyle({opacity: point.options.opacity * 0.9, fillOpacity: point.options.fillOpacity * 0.9})
      else
        point.setStyle({opacity: 1, fillOpacity: 1})

    setTimeout(insertNextPoint, 300)

  insertNextPoint()


  # test-map.on 'click', (ev)->
  #   coordinates = ev.latlng
  #   Turbolinks.visit "/agile_pois/new?latitude=#{coordinates.lat}&longitude=#{coordinates.lng}"

$(document).ready(ready)
$(document).on('page:load', ready)
